import{_ as z,a as j,g as d,c as S,o as P,b as a,d as e,h as Q,i as c,j as u,v as V,m as v,F as y,k as T,s as G,t as i,l as H,x as w,y as J,z as I,f as n,n as K,A as O,B as M,C as W,D as X}from"./index-BImh0Udg.js";import{u as Y}from"./residents-aQAaffLr.js";const Z={class:"tickets"},_={class:"header"},h={class:"filters"},tt={class:"search-box"},et={class:"filter-options"},st=["value"],lt={key:0,class:"tickets-list"},ot={key:0,class:"no-results"},at={key:1,class:"tickets-grid"},nt={class:"ticket-header"},it={class:"ticket-info"},ut={class:"ticket-description"},dt={class:"ticket-actions"},rt=["onClick"],vt=["onClick"],pt={key:1,class:"loading"},ft={key:2,class:"modal"},ct={class:"modal-content"},mt={class:"form-group"},gt={class:"form-group"},kt=["value"],bt={class:"form-group"},yt=["value"],Tt={class:"form-group"},Ct={class:"form-group"},St={class:"form-group"},Vt={class:"form-actions"},wt={__name:"Tickets",setup(It){const D=j(),U=Y(),m=d(!1),p=d(!1),f=d(null),g=d(""),k=d(""),b=d(""),o=d({title:"",buildingId:"",residentId:"",category:"",description:"",status:"open"}),B=d([]),q=()=>{m.value=!0;const l=w(I,"tickets");J(l).then(t=>{const s=t.docs.map(r=>({id:r.id,...r.data()}));B.value=s,m.value=!1}).catch(t=>{console.error("Error loading tickets:",t),m.value=!1})},N=S(()=>B.value.filter(l=>{const t=l.title.toLowerCase().includes(g.value.toLowerCase())||l.description.toLowerCase().includes(g.value.toLowerCase()),s=!k.value||l.buildingId===k.value,r=!b.value||l.status===b.value;return t&&s&&r})),C=S(()=>D.buildings),L=S(()=>U.residents),x=l=>{const t=C.value.find(s=>s.id===l);return t?t.name:"Неизвестный дом"},E=l=>({open:"Открытая",in_progress:"В работе",resolved:"Решенная",closed:"Закрытая"})[l]||l,R=l=>new Date(l).toLocaleDateString("ru-RU"),$=l=>{f.value=l,o.value={...l},p.value=!0},A=async()=>{try{const l={...o.value},t=w(I,"tickets");f.value?await W(M(t,f.value.id),l):await X(t,l),p.value=!1,f.value=null,o.value={title:"",buildingId:"",residentId:"",category:"",description:"",status:"open"}}catch(l){console.error("Error saving ticket:",l),alert("Ошибка при сохранении заявки")}},F=async l=>{if(confirm("Вы уверены, что хотите удалить эту заявку?"))try{await O(M(w(I,"tickets"),l))}catch(t){console.error("Error deleting ticket:",t),alert("Ошибка при удалении заявки")}};return P(async()=>{try{await Promise.all([D.fetchBuildings(),U.fetchResidents()]),q()}catch(l){console.error("Error loading data:",l)}}),(l,t)=>(n(),a("div",Z,[e("div",_,[t[15]||(t[15]=e("h1",null,"Заявки",-1)),e("button",{class:"add-button",onClick:t[0]||(t[0]=s=>p.value=!0)},t[14]||(t[14]=[e("i",{class:"fas fa-plus"},null,-1),c(" Создать заявку ")]))]),e("div",h,[e("div",tt,[t[16]||(t[16]=e("i",{class:"fas fa-search"},null,-1)),u(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>g.value=s),type:"text",placeholder:"Поиск по заявкам...",onInput:t[2]||(t[2]=(...s)=>l.filterTickets&&l.filterTickets(...s))},null,544),[[V,g.value]])]),e("div",et,[u(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>k.value=s),onChange:t[4]||(t[4]=(...s)=>l.filterTickets&&l.filterTickets(...s))},[t[17]||(t[17]=e("option",{value:""},"Все дома",-1)),(n(!0),a(y,null,T(C.value,s=>(n(),a("option",{key:s.id,value:s.id},i(s.name),9,st))),128))],544),[[v,k.value]]),u(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>b.value=s),onChange:t[6]||(t[6]=(...s)=>l.filterTickets&&l.filterTickets(...s))},t[18]||(t[18]=[G('<option value="" data-v-f10ab851>Все статусы</option><option value="open" data-v-f10ab851>Открытые</option><option value="in_progress" data-v-f10ab851>В работе</option><option value="resolved" data-v-f10ab851>Решенные</option><option value="closed" data-v-f10ab851>Закрытые</option>',5)]),544),[[v,b.value]])])]),m.value?(n(),a("div",pt,t[26]||(t[26]=[e("i",{class:"fas fa-spinner fa-spin"},null,-1),e("p",null,"Загрузка...",-1)]))):(n(),a("div",lt,[N.value.length===0?(n(),a("div",ot,t[19]||(t[19]=[e("i",{class:"fas fa-search"},null,-1),e("p",null,"Ничего не найдено",-1)]))):(n(),a("div",at,[(n(!0),a(y,null,T(N.value,s=>(n(),a("div",{key:s.id,class:"ticket-card"},[e("div",nt,[e("h3",null,i(s.title),1),e("span",{class:K(["status-badge",s.status])},i(E(s.status)),3)]),e("div",it,[e("p",null,[t[20]||(t[20]=e("i",{class:"fas fa-building"},null,-1)),c(" "+i(x(s.buildingId)),1)]),e("p",null,[t[21]||(t[21]=e("i",{class:"fas fa-user"},null,-1)),c(" "+i(s.residentName),1)]),e("p",null,[t[22]||(t[22]=e("i",{class:"fas fa-calendar"},null,-1)),c(" "+i(R(s.createdAt)),1)]),e("p",null,[t[23]||(t[23]=e("i",{class:"fas fa-tag"},null,-1)),c(" "+i(s.category),1)])]),e("div",ut,[e("p",null,i(s.description),1)]),e("div",dt,[e("button",{onClick:r=>$(s),class:"edit-button"},t[24]||(t[24]=[e("i",{class:"fas fa-edit"},null,-1)]),8,rt),e("button",{onClick:r=>F(s.id),class:"delete-button"},t[25]||(t[25]=[e("i",{class:"fas fa-trash"},null,-1)]),8,vt)])]))),128))]))])),p.value?(n(),a("div",ft,[e("div",ct,[e("h2",null,i(f.value?"Редактировать заявку":"Создать заявку"),1),e("form",{onSubmit:H(A,["prevent"])},[e("div",mt,[t[27]||(t[27]=e("label",null,"Заголовок",-1)),u(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>o.value.title=s),type:"text",required:""},null,512),[[V,o.value.title]])]),e("div",gt,[t[28]||(t[28]=e("label",null,"Дом",-1)),u(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>o.value.buildingId=s),required:""},[(n(!0),a(y,null,T(C.value,s=>(n(),a("option",{key:s.id,value:s.id},i(s.name),9,kt))),128))],512),[[v,o.value.buildingId]])]),e("div",bt,[t[29]||(t[29]=e("label",null,"Житель",-1)),u(e("select",{"onUpdate:modelValue":t[9]||(t[9]=s=>o.value.residentId=s),required:""},[(n(!0),a(y,null,T(L.value,s=>(n(),a("option",{key:s.id,value:s.id},i(s.firstName)+" "+i(s.lastName),9,yt))),128))],512),[[v,o.value.residentId]])]),e("div",Tt,[t[31]||(t[31]=e("label",null,"Категория",-1)),u(e("select",{"onUpdate:modelValue":t[10]||(t[10]=s=>o.value.category=s),required:""},t[30]||(t[30]=[e("option",{value:"repair"},"Ремонт",-1),e("option",{value:"cleaning"},"Уборка",-1),e("option",{value:"security"},"Безопасность",-1),e("option",{value:"other"},"Другое",-1)]),512),[[v,o.value.category]])]),e("div",Ct,[t[32]||(t[32]=e("label",null,"Описание",-1)),u(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=s=>o.value.description=s),required:""},null,512),[[V,o.value.description]])]),e("div",St,[t[34]||(t[34]=e("label",null,"Статус",-1)),u(e("select",{"onUpdate:modelValue":t[12]||(t[12]=s=>o.value.status=s),required:""},t[33]||(t[33]=[e("option",{value:"open"},"Открытая",-1),e("option",{value:"in_progress"},"В работе",-1),e("option",{value:"resolved"},"Решенная",-1),e("option",{value:"closed"},"Закрытая",-1)]),512),[[v,o.value.status]])]),e("div",Vt,[e("button",{type:"button",onClick:t[13]||(t[13]=s=>p.value=!1)},"Отмена"),t[35]||(t[35]=e("button",{type:"submit"},"Сохранить",-1))])],32)])])):Q("",!0)]))}},Bt=z(wt,[["__scopeId","data-v-f10ab851"]]);export{Bt as default};
