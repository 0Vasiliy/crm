import{_ as E,a as L,g as r,c as g,o as $,b as n,d as e,h as z,i as b,j as o,v as m,m as U,F as w,k as C,t as u,f as i,n as P}from"./index-BImh0Udg.js";import{u as R}from"./utilities-C_4KouiO.js";const j={class:"utilities"},Q={class:"header"},G={class:"actions"},H={class:"filters"},J={class:"search-box"},K={class:"filter-options"},W=["value"],X={class:"utilities-list"},Y={key:0,class:"loading"},Z={key:1,class:"no-results"},h={key:2,class:"utilities-grid"},tt={class:"utility-header"},et={class:"utility-actions"},st=["onClick"],lt=["onClick"],at={class:"utility-info"},nt={key:0,class:"modal"},it={class:"modal-content"},ot={class:"modal-header"},ut={class:"modal-body"},dt={class:"form-group"},rt={class:"form-group"},vt=["value"],pt={class:"form-group"},mt={class:"form-group"},ct={class:"form-group"},ft={class:"form-group"},gt={__name:"Utilities",setup(bt){const A=L(),d=R(),v=r(!1),p=r(null),y=r(""),c=r(""),f=r(""),a=r({name:"",buildingId:"",unit:"",rate:"",status:"active",createdAt:new Date().toISOString().split("T")[0]}),B=g(()=>d.utilities),_=g(()=>d.loading),S=g(()=>A.buildings),V=g(()=>B.value.filter(l=>{const t=l.name.toLowerCase().includes(y.value.toLowerCase()),s=!c.value||l.buildingId===c.value,I=!f.value||l.status===f.value;return t&&s&&I})),F=l=>new Intl.NumberFormat("ru-RU").format(l),T=l=>new Date(l).toLocaleDateString("ru-RU"),q=l=>{const t=S.value.find(s=>s.id===l);return t?t.name:"Неизвестное здание"},M=l=>{p.value=l,a.value={name:l.name,buildingId:l.buildingId,unit:l.unit,rate:l.rate,status:l.status,createdAt:l.createdAt?new Date(l.createdAt).toISOString().split("T")[0]:new Date().toISOString().split("T")[0]},v.value=!0},N=async()=>{try{const l={name:a.value.name.trim(),buildingId:a.value.buildingId,unit:a.value.unit.trim(),rate:parseFloat(a.value.rate),status:a.value.status,createdAt:new Date(a.value.createdAt).toISOString()};p.value?await d.updateUtility(p.value.id,l):await d.addUtility(l),v.value=!1,x()}catch(l){console.error("Error saving utility:",l),alert("Ошибка при сохранении услуги: "+l.message)}},O=async l=>{if(confirm("Вы уверены, что хотите удалить эту услугу?"))try{await d.deleteUtility(l)}catch(t){console.error("Error deleting utility:",t),alert("Ошибка при удалении услуги")}},D=()=>{v.value=!1,x()},x=()=>{a.value={name:"",buildingId:"",unit:"",rate:"",status:"active",createdAt:new Date().toISOString().split("T")[0]},p.value=null},k=()=>{};return $(async()=>{try{await Promise.all([A.fetchBuildings(),d.fetchUtilities()])}catch(l){console.error("Error initializing utilities module:",l)}}),(l,t)=>(i(),n("div",j,[e("div",Q,[t[11]||(t[11]=e("h1",null,"Коммунальные услуги",-1)),e("div",G,[e("button",{class:"add-button",onClick:t[0]||(t[0]=s=>v.value=!0)},t[10]||(t[10]=[e("i",{class:"fas fa-plus"},null,-1),b(" Добавить услугу ")]))])]),e("div",H,[e("div",J,[t[12]||(t[12]=e("i",{class:"fas fa-search"},null,-1)),o(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>y.value=s),type:"text",placeholder:"Поиск по услугам...",onInput:k},null,544),[[m,y.value]])]),e("div",K,[o(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>c.value=s),onChange:k},[t[13]||(t[13]=e("option",{value:""},"Все дома",-1)),(i(!0),n(w,null,C(S.value,s=>(i(),n("option",{key:s.id,value:s.id},u(s.name),9,W))),128))],544),[[U,c.value]]),o(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>f.value=s),onChange:k},t[14]||(t[14]=[e("option",{value:""},"Все статусы",-1),e("option",{value:"active"},"Активные",-1),e("option",{value:"inactive"},"Неактивные",-1)]),544),[[U,f.value]])])]),e("div",X,[_.value?(i(),n("div",Y,t[15]||(t[15]=[e("i",{class:"fas fa-spinner fa-spin"},null,-1),e("p",null,"Загрузка услуг...",-1)]))):V.value.length===0?(i(),n("div",Z,t[16]||(t[16]=[e("i",{class:"fas fa-search"},null,-1),e("p",null,"Услуги не найдены",-1)]))):(i(),n("div",h,[(i(!0),n(w,null,C(V.value,s=>(i(),n("div",{key:s.id,class:"utility-card"},[e("div",tt,[e("h3",null,u(s.name),1),e("div",et,[e("button",{onClick:I=>M(s),class:"edit-button"},t[17]||(t[17]=[e("i",{class:"fas fa-edit"},null,-1)]),8,st),e("button",{onClick:I=>O(s.id),class:"delete-button"},t[18]||(t[18]=[e("i",{class:"fas fa-trash"},null,-1)]),8,lt),e("span",{class:P(["status-badge",s.status])},u(s.status==="active"?"Активна":"Неактивна"),3)])]),e("div",at,[e("p",null,[t[19]||(t[19]=e("i",{class:"fas fa-building"},null,-1)),b(" "+u(q(s.buildingId)),1)]),e("p",null,[t[20]||(t[20]=e("i",{class:"fas fa-money-bill"},null,-1)),b(" "+u(F(s.rate))+" ₽/"+u(s.unit),1)]),e("p",null,[t[21]||(t[21]=e("i",{class:"fas fa-calendar"},null,-1)),b(" Создана: "+u(T(s.createdAt)),1)])])]))),128))]))]),v.value?(i(),n("div",nt,[e("div",it,[e("div",ot,[e("h3",null,u(p.value?"Редактировать услугу":"Добавить услугу"),1),e("button",{class:"close-button",onClick:D},"×")]),e("div",ut,[e("div",dt,[t[22]||(t[22]=e("label",null,"Название услуги",-1)),o(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.name=s),type:"text",placeholder:"Введите название услуги",required:""},null,512),[[m,a.value.name]])]),e("div",rt,[t[24]||(t[24]=e("label",null,"Здание",-1)),o(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>a.value.buildingId=s),required:""},[t[23]||(t[23]=e("option",{value:""},"Выберите здание",-1)),(i(!0),n(w,null,C(S.value,s=>(i(),n("option",{key:s.id,value:s.id},u(s.name),9,vt))),128))],512),[[U,a.value.buildingId]])]),e("div",pt,[t[25]||(t[25]=e("label",null,"Единица измерения",-1)),o(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>a.value.unit=s),type:"text",placeholder:"Например: кВт⋅ч, м³",required:""},null,512),[[m,a.value.unit]])]),e("div",mt,[t[26]||(t[26]=e("label",null,"Тариф (₽)",-1)),o(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>a.value.rate=s),type:"number",step:"0.01",min:"0",placeholder:"Введите тариф",required:""},null,512),[[m,a.value.rate]])]),e("div",ct,[t[28]||(t[28]=e("label",null,"Статус",-1)),o(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>a.value.status=s)},t[27]||(t[27]=[e("option",{value:"active"},"Активна",-1),e("option",{value:"inactive"},"Неактивна",-1)]),512),[[U,a.value.status]])]),e("div",ft,[t[29]||(t[29]=e("label",null,"Дата создания",-1)),o(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>a.value.createdAt=s),type:"date",required:""},null,512),[[m,a.value.createdAt]])])]),e("div",{class:"modal-actions"},[e("button",{class:"btn btn-secondary",onClick:D},"Отмена"),e("button",{class:"btn btn-primary",onClick:N},"Сохранить")])])])):z("",!0)]))}},St=E(gt,[["__scopeId","data-v-90631024"]]);export{St as default};
