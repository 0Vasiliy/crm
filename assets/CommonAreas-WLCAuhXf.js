import{f as E,g as F,h as S,i as V,Q as k,e as T}from"./QTabPanels-7m-2RM3o.js";import{P as G,g as i,y as D,x as g,z as y,D as M,B as U,C as H,A as J,_ as K,b as N,d as t,h as L,e as n,w as v,n as W,t as X,o as Y,f as O,a4 as B,a5 as I,a8 as x,a6 as P}from"./index-94aisbhc.js";const Z=G("commonAreas",()=>{const r=i([]),o=i([]),f=i([]),e=i(!1),c=i(null);return{commonAreas:r,bookings:o,maintenanceSchedule:f,loading:e,error:c,fetchCommonAreas:async()=>{e.value=!0,c.value=null;try{const l=await D(g(y,"commonAreas"));r.value=l.docs.map(a=>({id:a.id,...a.data()}))}catch(l){c.value=l.message,console.error("Ошибка при загрузке помещений:",l)}finally{e.value=!1}},addCommonArea:async l=>{try{const d={id:(await M(g(y,"commonAreas"),{...l,createdAt:new Date().toISOString()})).id,...l};return r.value.push(d),d}catch(a){throw c.value=a.message,console.error("Ошибка при добавлении помещения:",a),a}},updateCommonArea:async(l,a)=>{try{const d=U(y,"commonAreas",l);await H(d,{...a,updatedAt:new Date().toISOString()});const _=r.value.findIndex(C=>C.id===l);_!==-1&&(r.value[_]={...r.value[_],...a})}catch(d){throw c.value=d.message,console.error("Ошибка при обновлении помещения:",d),d}},deleteCommonArea:async l=>{try{await J(U(y,"commonAreas",l)),r.value=r.value.filter(a=>a.id!==l)}catch(a){throw c.value=a.message,console.error("Ошибка при удалении помещения:",a),a}},fetchBookings:async()=>{e.value=!0;try{const l=await D(g(y,"bookings"));o.value=l.docs.map(a=>({id:a.id,...a.data()}))}catch(l){c.value=l.message,console.error("Ошибка при загрузке бронирований:",l)}finally{e.value=!1}},addBooking:async l=>{try{const d={id:(await M(g(y,"bookings"),{...l,createdAt:new Date().toISOString()})).id,...l};return o.value.push(d),d}catch(a){throw c.value=a.message,console.error("Ошибка при добавлении бронирования:",a),a}},fetchMaintenanceSchedule:async()=>{e.value=!0;try{const l=await D(g(y,"maintenanceSchedule"));f.value=l.docs.map(a=>({id:a.id,...a.data()}))}catch(l){c.value=l.message,console.error("Ошибка при загрузке графика обслуживания:",l)}finally{e.value=!1}},addMaintenanceRecord:async l=>{try{const d={id:(await M(g(y,"maintenanceSchedule"),{...l,createdAt:new Date().toISOString()})).id,...l};return f.value.push(d),d}catch(a){throw c.value=a.message,console.error("Ошибка при добавлении записи обслуживания:",a),a}}}}),$={name:"CommonAreasModule",setup(){const r=Z(),o=i("areas"),f=i(!1),e=i(null),c=i(null),b=i(null),s=i(null),h=i(null),w=i(null),p=i({show:!1,message:"",type:""}),u=(m,A="success")=>{p.value={show:!0,message:m,type:A},setTimeout(()=>{p.value.show=!1},3e3)},Q=[{name:"id",label:"ID",field:"id",sortable:!0},{name:"name",label:"Название",field:"name",sortable:!0},{name:"type",label:"Тип",field:"type",sortable:!0},{name:"capacity",label:"Вместимость",field:"capacity",sortable:!0},{name:"status",label:"Статус",field:"status",sortable:!0},{name:"location",label:"Расположение",field:"location",sortable:!0}],R=[{name:"id",label:"ID",field:"id",sortable:!0},{name:"area",label:"Помещение",field:"area",sortable:!0},{name:"resident",label:"Жилец",field:"resident",sortable:!0},{name:"date",label:"Дата",field:"date",sortable:!0},{name:"time",label:"Время",field:"time",sortable:!0},{name:"status",label:"Статус",field:"status",sortable:!0}],l=[{name:"id",label:"ID",field:"id",sortable:!0},{name:"area",label:"Помещение",field:"area",sortable:!0},{name:"type",label:"Тип",field:"type",sortable:!0},{name:"date",label:"Дата",field:"date",sortable:!0},{name:"status",label:"Статус",field:"status",sortable:!0},{name:"contractor",label:"Подрядчик",field:"contractor",sortable:!0}],a=[{label:"Клубная комната",value:"club"},{label:"Спортзал",value:"gym"},{label:"Конференц-зал",value:"conference"},{label:"Детская комната",value:"playroom"}],d=[{label:"Доступно",value:"available"},{label:"Занято",value:"occupied"},{label:"На обслуживании",value:"maintenance"}],_=[{label:"Уборка",value:"cleaning"},{label:"Ремонт",value:"repair"},{label:"Проверка",value:"inspection"}],C=async()=>{if(!e.value||!c.value){u("Пожалуйста, заполните все обязательные поля","error");return}try{const m={type:e.value,status:c.value,name:`Помещение ${commonAreas.value.length+1}`,capacity:0,location:"Не указано"};await r.addCommonArea(m),u("Помещение успешно добавлено"),e.value=null,c.value=null}catch{u("Ошибка при добавлении помещения","error")}},z=async()=>{if(!b.value||!s.value){u("Пожалуйста, выберите помещение и дату","error");return}try{const m={areaId:b.value.id,areaName:b.value.name,date:s.value,status:"pending",residentId:"current-user-id",residentName:"Текущий пользователь"};await r.addBooking(m),u("Помещение успешно забронировано"),b.value=null,s.value=null}catch{u("Ошибка при бронировании помещения","error")}},j=async()=>{var m,A;if(!h.value||!w.value){u("Пожалуйста, выберите тип обслуживания и дату","error");return}try{const q={type:h.value,date:w.value,status:"scheduled",contractor:"Не назначен",areaId:(m=b.value)==null?void 0:m.id,areaName:(A=b.value)==null?void 0:A.name};await r.addMaintenanceRecord(q),u("Обслуживание успешно запланировано"),h.value=null,w.value=null}catch{u("Ошибка при планировании обслуживания","error")}};return Y(async()=>{f.value=!0;try{await Promise.all([r.fetchCommonAreas(),r.fetchBookings(),r.fetchMaintenanceSchedule()])}catch{u("Ошибка при загрузке данных","error")}finally{f.value=!1}}),{activeTab:o,loading:f,selectedType:e,selectedStatus:c,selectedArea:b,bookingDate:s,selectedMaintenanceType:h,maintenanceDate:w,areaColumns:Q,bookingColumns:R,maintenanceColumns:l,areaTypes:a,areaStatuses:d,maintenanceTypes:_,commonAreas:r.commonAreas,bookings:r.bookings,maintenanceSchedule:r.maintenanceSchedule,notification:p,addArea:C,bookArea:z,scheduleMaintenance:j}}},ee={class:"common-areas-module"},ae={class:"common-areas-tabs"},le={class:"row q-col-gutter-md"},oe={class:"col-12"},ne={class:"row q-col-gutter-md"},te={class:"col-12 col-md-4"},se={class:"col-12 col-md-4"},re={class:"col-12 col-md-4"},ce={class:"row q-col-gutter-md"},de={class:"col-12"},ie={class:"row q-col-gutter-md"},ue={class:"col-12 col-md-4"},me={class:"col-12 col-md-4"},ve={class:"col-12 col-md-4"},be={class:"row q-col-gutter-md"},fe={class:"col-12"},ye={class:"row q-col-gutter-md"},ge={class:"col-12 col-md-4"},he={class:"col-12 col-md-4"},we={class:"col-12 col-md-4"};function _e(r,o,f,e,c,b){return O(),N("div",ee,[o[11]||(o[11]=t("h1",null,"Общественные помещения",-1)),t("div",ae,[n(E,{modelValue:e.activeTab,"onUpdate:modelValue":o[0]||(o[0]=s=>e.activeTab=s),class:"text-primary","active-color":"primary","indicator-color":"primary",align:"justify"},{default:v(()=>[n(S,{name:"areas",label:"Помещения"}),n(S,{name:"bookings",label:"Бронирование"}),n(S,{name:"maintenance",label:"Обслуживание"})]),_:1},8,["modelValue"]),n(F,{modelValue:e.activeTab,"onUpdate:modelValue":o[7]||(o[7]=s=>e.activeTab=s),animated:""},{default:v(()=>[n(V,{name:"areas"},{default:v(()=>[t("div",le,[t("div",oe,[n(B,null,{default:v(()=>[n(I,null,{default:v(()=>[o[8]||(o[8]=t("div",{class:"text-h6"},"Управление помещениями",-1)),t("div",ne,[t("div",te,[n(k,{modelValue:e.selectedType,"onUpdate:modelValue":o[1]||(o[1]=s=>e.selectedType=s),options:e.areaTypes,label:"Тип помещения"},null,8,["modelValue","options"])]),t("div",se,[n(k,{modelValue:e.selectedStatus,"onUpdate:modelValue":o[2]||(o[2]=s=>e.selectedStatus=s),options:e.areaStatuses,label:"Статус"},null,8,["modelValue","options"])]),t("div",re,[n(x,{color:"primary",label:"Добавить помещение",onClick:e.addArea},null,8,["onClick"])])]),n(T,{rows:e.commonAreas,columns:e.areaColumns,"row-key":"id",loading:e.loading},null,8,["rows","columns","loading"])]),_:1,__:[8]})]),_:1})])])]),_:1}),n(V,{name:"bookings"},{default:v(()=>[t("div",ce,[t("div",de,[n(B,null,{default:v(()=>[n(I,null,{default:v(()=>[o[9]||(o[9]=t("div",{class:"text-h6"},"Бронирование помещений",-1)),t("div",ie,[t("div",ue,[n(k,{modelValue:e.selectedArea,"onUpdate:modelValue":o[3]||(o[3]=s=>e.selectedArea=s),options:e.commonAreas,label:"Помещение"},null,8,["modelValue","options"])]),t("div",me,[n(P,{modelValue:e.bookingDate,"onUpdate:modelValue":o[4]||(o[4]=s=>e.bookingDate=s),type:"date",label:"Дата"},null,8,["modelValue"])]),t("div",ve,[n(x,{color:"primary",label:"Забронировать",onClick:e.bookArea},null,8,["onClick"])])]),n(T,{rows:e.bookings,columns:e.bookingColumns,"row-key":"id",loading:e.loading},null,8,["rows","columns","loading"])]),_:1,__:[9]})]),_:1})])])]),_:1}),n(V,{name:"maintenance"},{default:v(()=>[t("div",be,[t("div",fe,[n(B,null,{default:v(()=>[n(I,null,{default:v(()=>[o[10]||(o[10]=t("div",{class:"text-h6"},"Обслуживание помещений",-1)),t("div",ye,[t("div",ge,[n(k,{modelValue:e.selectedMaintenanceType,"onUpdate:modelValue":o[5]||(o[5]=s=>e.selectedMaintenanceType=s),options:e.maintenanceTypes,label:"Тип обслуживания"},null,8,["modelValue","options"])]),t("div",he,[n(P,{modelValue:e.maintenanceDate,"onUpdate:modelValue":o[6]||(o[6]=s=>e.maintenanceDate=s),type:"date",label:"Дата"},null,8,["modelValue"])]),t("div",we,[n(x,{color:"primary",label:"Запланировать",onClick:e.scheduleMaintenance},null,8,["onClick"])])]),n(T,{rows:e.maintenanceSchedule,columns:e.maintenanceColumns,"row-key":"id",loading:e.loading},null,8,["rows","columns","loading"])]),_:1,__:[10]})]),_:1})])])]),_:1})]),_:1},8,["modelValue"])]),e.notification.show?(O(),N("div",{key:0,class:W(["notification",e.notification.type])},X(e.notification.message),3)):L("",!0)])}const ke=K($,[["render",_e],["__scopeId","data-v-411b2fc2"]]);export{ke as default};
