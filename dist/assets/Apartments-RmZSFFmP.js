import{_ as W,u as X,a as Y,g as d,c as N,o as Z,b as n,d as t,h as w,i as g,j as r,v,m as S,F as V,k as R,t as i,l as E,f as o,n as h}from"./index-BImh0Udg.js";import{u as ee}from"./residents-aQAaffLr.js";const te={class:"apartments"},se={class:"header"},le={class:"filters"},ae={class:"search-box"},ne={class:"filter-options"},oe=["value"],ue={key:0,class:"apartments-list"},ie={key:0,class:"no-results"},re={key:1,class:"apartments-grid"},de={class:"apartment-header"},ve={class:"apartment-info"},me={class:"apartment-actions"},pe=["onClick"],fe=["onClick"],be=["onClick"],ge={key:1,class:"loading"},ye={key:2,class:"modal"},ce={class:"modal-content"},ke={class:"form-group"},Ie={class:"form-group"},De=["value"],Ne={class:"form-group"},Ce={class:"form-group"},Ae={class:"form-group"},we={class:"form-actions"},Ve={key:3,class:"modal"},Re={class:"modal-content"},Ue={class:"residents-list"},qe={key:0,class:"no-residents"},Oe={key:1,class:"residents-grid"},Se={class:"resident-info"},$e={key:0},xe={class:"resident-actions"},Be=["onClick"],Me=["onClick"],Ee={class:"modal-actions"},Fe={key:4,class:"modal"},_e={class:"modal-content"},Le={class:"form-group"},Te={class:"form-group"},je={class:"form-group"},ze={class:"form-group"},Pe={class:"form-group"},Qe={class:"form-group"},Ge={class:"form-actions"},He={__name:"Apartments",setup(Je){const m=X(),$=Y(),y=ee(),U=d(!1),c=d(!1),q=d(!1),k=d(!1),I=d(null),D=d(null),p=d(null),C=d(""),f=d(""),u=d({number:"",buildingId:"",area:"",rooms:"",status:"active"}),a=d({firstName:"",lastName:"",phone:"",email:"",apartmentId:"",moveInDate:"",moveOutDate:""}),O=N(()=>$.buildings),F=N(()=>m.apartments),_=N(()=>y.residents),x=N(()=>p.value?_.value.filter(l=>l.apartmentId===p.value.id):[]),B=N(()=>{let l=F.value;if(C.value){const e=C.value.toLowerCase();l=l.filter(b=>b.number.toLowerCase().includes(e))}return f.value&&(l=l.filter(e=>e.buildingId===f.value)),l}),L=l=>{const e=O.value.find(b=>b.id===l);return e?e.name:"Неизвестно"},M=l=>l?new Date(l).toLocaleDateString("ru-RU"):"",T=l=>{p.value=l,q.value=!0},j=()=>{q.value=!1,p.value=null},z=l=>{I.value=l,u.value={number:l.number,buildingId:l.buildingId,area:l.area,rooms:l.rooms,status:l.status},c.value=!0},P=l=>{D.value=l,a.value={firstName:l.firstName,lastName:l.lastName,phone:l.phone,email:l.email,apartmentId:l.apartmentId,moveInDate:l.moveInDate,moveOutDate:l.moveOutDate||""},k.value=!0},Q=async()=>{try{const l={number:u.value.number,buildingId:u.value.buildingId,area:parseFloat(u.value.area),rooms:parseInt(u.value.rooms),status:u.value.status};I.value?await m.updateApartment(I.value.id,l):await m.addApartment(l),c.value=!1,I.value=null,u.value={number:"",buildingId:"",area:"",rooms:"",status:"active"}}catch(l){console.error("Error saving apartment:",l),alert("Ошибка при сохранении квартиры: "+l.message)}},G=async()=>{try{const l={firstName:a.value.firstName,lastName:a.value.lastName,phone:a.value.phone,email:a.value.email,apartmentId:p.value.id,moveInDate:a.value.moveInDate,moveOutDate:a.value.moveOutDate||null};D.value?await y.updateResident(D.value.id,l):await y.addResident(l),k.value=!1,D.value=null,a.value={firstName:"",lastName:"",phone:"",email:"",apartmentId:"",moveInDate:"",moveOutDate:""}}catch(l){console.error("Error saving resident:",l),alert("Ошибка при сохранении жильца: "+l.message)}},H=async l=>{if(confirm("Вы уверены, что хотите удалить эту квартиру?"))try{await m.deleteApartment(l)}catch(e){console.error("Error deleting apartment:",e),alert("Ошибка при удалении квартиры: "+e.message)}},J=async l=>{if(confirm("Вы уверены, что хотите удалить этого жильца?"))try{await y.removeResident(l)}catch(e){console.error("Error deleting resident:",e),alert("Ошибка при удалении жильца: "+e.message)}},K=async()=>{f.value?await m.fetchApartments(f.value):await m.fetchApartments()};return Z(async()=>{try{U.value=!0,await Promise.all([$.fetchBuildings(),m.fetchApartments(),y.fetchResidents()])}catch(l){console.error("Error loading data:",l),alert("Ошибка при загрузке данных: "+l.message)}finally{U.value=!1}}),(l,e)=>{var b;return o(),n("div",te,[t("div",se,[e[19]||(e[19]=t("h1",null,"Квартиры",-1)),t("button",{class:"add-button",onClick:e[0]||(e[0]=s=>c.value=!0)},e[18]||(e[18]=[t("i",{class:"fas fa-plus"},null,-1),g(" Добавить квартиру ")]))]),t("div",le,[t("div",ae,[e[20]||(e[20]=t("i",{class:"fas fa-search"},null,-1)),r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>C.value=s),type:"text",placeholder:"Поиск по квартирам...",onInput:e[2]||(e[2]=(...s)=>l.filterApartments&&l.filterApartments(...s))},null,544),[[v,C.value]])]),t("div",ne,[r(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>f.value=s),onChange:K},[e[21]||(e[21]=t("option",{value:""},"Все дома",-1)),(o(!0),n(V,null,R(O.value,s=>(o(),n("option",{key:s.id,value:s.id},i(s.name),9,oe))),128))],544),[[S,f.value]])])]),U.value?(o(),n("div",ge,e[29]||(e[29]=[t("i",{class:"fas fa-spinner fa-spin"},null,-1),t("p",null,"Загрузка...",-1)]))):(o(),n("div",ue,[B.value.length===0?(o(),n("div",ie,e[22]||(e[22]=[t("i",{class:"fas fa-search"},null,-1),t("p",null,"Ничего не найдено",-1)]))):(o(),n("div",re,[(o(!0),n(V,null,R(B.value,s=>(o(),n("div",{key:s.id,class:"apartment-card"},[t("div",de,[t("h3",null,"Квартира "+i(s.number),1),t("span",{class:h(["status-badge",{active:s.status==="active"}])},i(s.status==="active"?"Активна":"Неактивна"),3)]),t("div",ve,[t("p",null,[e[23]||(e[23]=t("i",{class:"fas fa-building"},null,-1)),g(" "+i(L(s.buildingId)),1)]),t("p",null,[e[24]||(e[24]=t("i",{class:"fas fa-door-open"},null,-1)),g(" "+i(s.area)+" м²",1)]),t("p",null,[e[25]||(e[25]=t("i",{class:"fas fa-bed"},null,-1)),g(" "+i(s.rooms)+" комнат",1)])]),t("div",me,[t("button",{onClick:A=>T(s),class:"residents-button"},e[26]||(e[26]=[t("i",{class:"fas fa-users"},null,-1),g(" Жильцы ")]),8,pe),t("button",{onClick:A=>z(s),class:"edit-button"},e[27]||(e[27]=[t("i",{class:"fas fa-edit"},null,-1)]),8,fe),t("button",{onClick:A=>H(s.id),class:"delete-button"},e[28]||(e[28]=[t("i",{class:"fas fa-trash"},null,-1)]),8,be)])]))),128))]))])),c.value?(o(),n("div",ye,[t("div",ce,[t("h2",null,i(I.value?"Редактировать квартиру":"Добавить квартиру"),1),t("form",{onSubmit:E(Q,["prevent"])},[t("div",ke,[e[30]||(e[30]=t("label",null,"Номер квартиры",-1)),r(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>u.value.number=s),type:"text",required:""},null,512),[[v,u.value.number]])]),t("div",Ie,[e[31]||(e[31]=t("label",null,"Дом",-1)),r(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>u.value.buildingId=s),required:""},[(o(!0),n(V,null,R(O.value,s=>(o(),n("option",{key:s.id,value:s.id},i(s.name),9,De))),128))],512),[[S,u.value.buildingId]])]),t("div",Ne,[e[32]||(e[32]=t("label",null,"Площадь (м²)",-1)),r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>u.value.area=s),type:"number",required:"",min:"1"},null,512),[[v,u.value.area]])]),t("div",Ce,[e[33]||(e[33]=t("label",null,"Количество комнат",-1)),r(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>u.value.rooms=s),type:"number",required:"",min:"1"},null,512),[[v,u.value.rooms]])]),t("div",Ae,[e[35]||(e[35]=t("label",null,"Статус",-1)),r(t("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>u.value.status=s),required:""},e[34]||(e[34]=[t("option",{value:"active"},"Активна",-1),t("option",{value:"inactive"},"Неактивна",-1)]),512),[[S,u.value.status]])]),t("div",we,[t("button",{type:"button",onClick:e[9]||(e[9]=s=>c.value=!1)},"Отмена"),e[36]||(e[36]=t("button",{type:"submit"},"Сохранить",-1))])],32)])])):w("",!0),q.value?(o(),n("div",Ve,[t("div",Re,[t("h2",null,"Жильцы квартиры "+i((b=p.value)==null?void 0:b.number),1),t("div",Ue,[x.value.length===0?(o(),n("div",qe,e[37]||(e[37]=[t("p",null,"В квартире нет жильцов",-1)]))):(o(),n("div",Oe,[(o(!0),n(V,null,R(x.value,s=>(o(),n("div",{key:s.id,class:"resident-card"},[t("div",Se,[t("h4",null,i(s.firstName)+" "+i(s.lastName),1),t("p",null,i(s.phone),1),t("p",null,"Заселение: "+i(M(s.moveInDate)),1),s.moveOutDate?(o(),n("p",$e,"Выселение: "+i(M(s.moveOutDate)),1)):w("",!0)]),t("div",xe,[t("button",{onClick:A=>P(s),class:"edit-button"},e[38]||(e[38]=[t("i",{class:"fas fa-edit"},null,-1)]),8,Be),t("button",{onClick:A=>J(s.id),class:"delete-button"},e[39]||(e[39]=[t("i",{class:"fas fa-trash"},null,-1)]),8,Me)])]))),128))]))]),t("div",Ee,[t("button",{onClick:e[10]||(e[10]=s=>k.value=!0),class:"add-resident-button"},e[40]||(e[40]=[t("i",{class:"fas fa-plus"},null,-1),g(" Добавить жильца ")])),t("button",{onClick:j,class:"close-button"},"Закрыть")])])])):w("",!0),k.value?(o(),n("div",Fe,[t("div",_e,[t("h2",null,i(D.value?"Редактировать жильца":"Добавить жильца"),1),t("form",{onSubmit:E(G,["prevent"])},[t("div",Le,[e[41]||(e[41]=t("label",null,"Имя",-1)),r(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>a.value.firstName=s),type:"text",required:""},null,512),[[v,a.value.firstName]])]),t("div",Te,[e[42]||(e[42]=t("label",null,"Фамилия",-1)),r(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>a.value.lastName=s),type:"text",required:""},null,512),[[v,a.value.lastName]])]),t("div",je,[e[43]||(e[43]=t("label",null,"Телефон",-1)),r(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>a.value.phone=s),type:"tel",required:""},null,512),[[v,a.value.phone]])]),t("div",ze,[e[44]||(e[44]=t("label",null,"Email",-1)),r(t("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>a.value.email=s),type:"email"},null,512),[[v,a.value.email]])]),t("div",Pe,[e[45]||(e[45]=t("label",null,"Дата заселения",-1)),r(t("input",{"onUpdate:modelValue":e[15]||(e[15]=s=>a.value.moveInDate=s),type:"date",required:""},null,512),[[v,a.value.moveInDate]])]),t("div",Qe,[e[46]||(e[46]=t("label",null,"Дата выселения",-1)),r(t("input",{"onUpdate:modelValue":e[16]||(e[16]=s=>a.value.moveOutDate=s),type:"date"},null,512),[[v,a.value.moveOutDate]])]),t("div",Ge,[t("button",{type:"button",onClick:e[17]||(e[17]=s=>k.value=!1)},"Отмена"),e[47]||(e[47]=t("button",{type:"submit"},"Сохранить",-1))])],32)])])):w("",!0)])}}},Xe=W(He,[["__scopeId","data-v-d9bd5a48"]]);export{Xe as default};
